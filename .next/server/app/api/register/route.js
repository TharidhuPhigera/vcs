try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},r=(new e.Error).stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="2eee3c85-837f-4d5f-b4e4-ce7cd7c851e2",e._sentryDebugIdIdentifier="sentry-dbid-2eee3c85-837f-4d5f-b4e4-ce7cd7c851e2")}catch(e){}try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},r=(new e.Error).stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="2eee3c85-837f-4d5f-b4e4-ce7cd7c851e2",e._sentryDebugIdIdentifier="sentry-dbid-2eee3c85-837f-4d5f-b4e4-ce7cd7c851e2")}catch(e){}(()=>{var e={};e.id=661,e.ids=[661],e.modules={44725:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=44725,e.exports=r},56801:e=>{"use strict";e.exports=require("import-in-the-middle")},56037:e=>{"use strict";e.exports=require("mongoose")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},19063:e=>{"use strict";e.exports=require("require-in-the-middle")},84297:e=>{"use strict";e.exports=require("async_hooks")},79646:e=>{"use strict";e.exports=require("child_process")},55511:e=>{"use strict";e.exports=require("crypto")},36686:e=>{"use strict";e.exports=require("diagnostics_channel")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},8086:e=>{"use strict";e.exports=require("module")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},74998:e=>{"use strict";e.exports=require("perf_hooks")},19771:e=>{"use strict";e.exports=require("process")},83997:e=>{"use strict";e.exports=require("tty")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},73566:e=>{"use strict";e.exports=require("worker_threads")},31421:e=>{"use strict";e.exports=require("node:child_process")},53053:e=>{"use strict";e.exports=require("node:diagnostics_channel")},73024:e=>{"use strict";e.exports=require("node:fs")},37067:e=>{"use strict";e.exports=require("node:http")},44708:e=>{"use strict";e.exports=require("node:https")},86592:e=>{"use strict";e.exports=require("node:inspector")},77030:e=>{"use strict";e.exports=require("node:net")},48161:e=>{"use strict";e.exports=require("node:os")},76760:e=>{"use strict";e.exports=require("node:path")},80481:e=>{"use strict";e.exports=require("node:readline")},57075:e=>{"use strict";e.exports=require("node:stream")},41692:e=>{"use strict";e.exports=require("node:tls")},57975:e=>{"use strict";e.exports=require("node:util")},98300:e=>{"use strict";e.exports=require("node:worker_threads")},38522:e=>{"use strict";e.exports=require("node:zlib")},40241:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>M,routeModule:()=>j,serverHooks:()=>C,workAsyncStorage:()=>R,workUnitAsyncStorage:()=>H});var s={};t.r(s),t.d(s,{DELETE:()=>U,GET:()=>_,HEAD:()=>I,OPTIONS:()=>N,PATCH:()=>O,POST:()=>k,PUT:()=>D});var o=t(42611),i=t(53420),n=t(6723),u=t(97391),a=t(63033),c=t(29262),d=t(21452),p=t(57301),l=t.n(p),y=t(77890);async function x(e){try{let{username:r,password:t,role:s}=await e.json();if("admin"!==s&&"employee"!==s)return y.NextResponse.json({message:"Invalid role. Must be either 'admin' or 'employee'."},{status:400});let o=await fetch("http://localhost:3000/api/userExists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:r})});if((await o.json()).userExists)return y.NextResponse.json({message:"User already exists."},{status:400});let i=await l().hash(t,10);return await (0,c.N)(),await d.A.create({username:r,password:i,role:s}),e.session||(e.session={}),e.session.user={username:r,role:s},console.log("User session:",e.session.user),y.NextResponse.json({message:"User registered."},{status:201})}catch(e){return console.error("Error during registration:",e),y.NextResponse.json({message:"An error occurred while registering the user."},{status:500})}}let g={...a},f="workUnitAsyncStorage"in g?g.workUnitAsyncStorage:"requestAsyncStorage"in g?g.requestAsyncStorage:void 0;function h(e,r){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,t,s)=>{let o;try{let e=f?.getStore();o=e?.headers}catch(e){}return u.wrapRouteHandlerWithSentry(e,{method:r,parameterizedRoute:"/api/register",headers:o}).apply(t,s)}})}let q=h(void 0,"GET"),w=h(x,"POST"),m=h(void 0,"PUT"),b=h(void 0,"PATCH"),v=h(void 0,"DELETE"),S=h(void 0,"HEAD"),E=h(void 0,"OPTIONS"),T={...a},A="workUnitAsyncStorage"in T?T.workUnitAsyncStorage:"requestAsyncStorage"in T?T.requestAsyncStorage:void 0;function P(e,r){return"phase-production-build"===process.env.NEXT_PHASE||"function"!=typeof e?e:new Proxy(e,{apply:(e,t,s)=>{let o;try{let e=A?.getStore();o=e?.headers}catch(e){}return u.wrapRouteHandlerWithSentry(e,{method:r,parameterizedRoute:"/api/register",headers:o}).apply(t,s)}})}let _=P(q,"GET"),k=P(w,"POST"),D=P(m,"PUT"),O=P(b,"PATCH"),U=P(v,"DELETE"),I=P(S,"HEAD"),N=P(E,"OPTIONS"),j=new o.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/register/route",pathname:"/api/register",filename:"route",bundlePath:"app/api/register/route"},resolvedPagePath:"/Users/tharidhu/vcs/app/api/register/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:R,workUnitAsyncStorage:H,serverHooks:C}=j;function M(){return(0,n.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:H})}},96487:()=>{},78335:()=>{},21452:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});var s=t(56037),o=t.n(s),i=t(57301),n=t.n(i);let u=new(o()).Schema({username:{type:String,required:!0,unique:!0},password:{type:String,required:!0},role:{type:String,required:!0}});u.methods.comparePassword=async function(e){return n().compare(e,this.password)};let a=o().models.User||o().model("User",u)},29262:(e,r,t)=>{"use strict";t.d(r,{N:()=>i});var s=t(56037),o=t.n(s);async function i(){if(!o().connections[0].readyState)try{await o().connect(process.env.MONGO_URI),console.log("Database connected")}catch(e){throw console.error("Database connection failed",e),Error("Database connection failed")}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[723,391,972,301],()=>t(40241));module.exports=s})();
//# sourceMappingURL=route.js.map